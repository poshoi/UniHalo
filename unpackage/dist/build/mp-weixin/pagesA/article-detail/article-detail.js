(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesA/article-detail/article-detail"],{"0dde":function(t,e,n){"use strict";n.r(e);var o=n("1174"),a=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=a.a},1174:function(t,e,n){"use strict";(function(t){var o=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=o(n("2eee")),i=o(n("c973")),r=o(n("1c22")),c={components:{tmSkeleton:function(){n.e("tm-vuetify/components/tm-skeleton/tm-skeleton").then(function(){return resolve(n("3f1b"))}.bind(null,n)).catch(n.oe)},tmPoup:function(){n.e("tm-vuetify/components/tm-poup/tm-poup").then(function(){return resolve(n("2b9f"))}.bind(null,n)).catch(n.oe)},tmFlotbutton:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-flotbutton/tm-flotbutton")]).then(function(){return resolve(n("1902"))}.bind(null,n)).catch(n.oe)},tmButton:function(){n.e("tm-vuetify/components/tm-button/tm-button").then(function(){return resolve(n("9bbf"))}.bind(null,n)).catch(n.oe)},tmEmpty:function(){n.e("tm-vuetify/components/tm-empty/tm-empty").then(function(){return resolve(n("947c"))}.bind(null,n)).catch(n.oe)},mpHtml:function(){Promise.all([n.e("common/vendor"),n.e("components/mp-html/components/mp-html/mp-html")]).then(function(){return resolve(n("a79e"))}.bind(null,n)).catch(n.oe)},commentList:function(){n.e("components/comment-list/comment-list").then(function(){return resolve(n("aed4"))}.bind(null,n)).catch(n.oe)},commentItem:function(){n.e("components/comment-item/comment-item").then(function(){return resolve(n("7cdb"))}.bind(null,n)).catch(n.oe)},rCanvas:function(){Promise.all([n.e("common/vendor"),n.e("components/r-canvas/r-canvas")]).then(function(){return resolve(n("6c00"))}.bind(null,n)).catch(n.oe)},barrage:function(){Promise.all([n.e("common/vendor"),n.e("components/barrage/barrage")]).then(function(){return resolve(n("57dc"))}.bind(null,n)).catch(n.oe)}},data:function(){return{loading:"loading",markdownConfig:r.default,btnOption:{actions:[{icon:"icon-like",color:"bg-gradient-orange-accent"},{icon:"icon-commentdots-fill",color:"bg-gradient-green-accent"},{icon:"icon-share1",color:"bg-gradient-blue-accent"}]},queryParams:{articleId:null},result:{},commentDetail:{loading:"loading",show:!1,comment:{},postId:void 0,list:[]},poster:{show:!1,showCanvas:!1,loading:!0,res:null}}},computed:{copyright:function(){return getApp().globalData.copyright},calcUrl:function(){var t=this;return function(e){return t.$utils.checkIsUrl(e)?e:getApp().globalData.baseApiUrl+e}},bloggerInfo:function(){var t=this.$tm.vx.getters().getBlogger;return t.avatar=this.$utils.checkAvatarUrl(t.avatar,!0),t}},onLoad:function(t){this.fnSetPageTitle("文章加载中..."),this.queryParams.articleId=t.articleId,this.fnGetData()},onPullDownRefresh:function(){this.fnGetData()},methods:{fnGetData:function(){var e=this;this.loading="loading",t.showLoading({mask:!0,title:"加载中..."}),this.$httpApi.getArticleDetail(this.queryParams.articleId).then((function(t){e.result=t.data,e.fnSetPageTitle("文章详情"),e.loading="success",e.fnSetWxShareInfo()})).catch((function(t){e.loading="error"})).finally((function(){t.hideLoading(),t.stopPullDownRefresh()}))},fnSetWxShareInfo:function(){t.$tm.vx.commit("setWxShare",{title:this.result.title,desc:this.result.summary,imageUrl:this.$utils.checkThumbnailUrl(this.result.thumbnail),path:"/pagesA/article-detail/article-detail?articleId=".concat(this.queryParams.articleId),copyLink:this.$haloConfig.apiUrl,query:{}})},fnOnFlotButtonChange:function(t){switch(t){case 0:this.fnDoLikes();break;case 1:this.fnToComment();break;case 2:this.fnShowShare();break}},fnToComment:function(){if(this.result.disallowComment)return t.$tm.toast("文章已开启禁止评论！");this.$Router.push({path:"/pagesA/comment/comment",query:{id:this.result.id,parentId:0,title:this.result.title,from:"posts",formPage:"comment_list",type:"post"}})},fnDoLikes:function(){var e=this;this.$httpApi.postLikePost(this.result.id).then((function(n){200==n.status?(e.result.likes+=1,t.$tm.toast("(^o^)/~点赞成功!")):t.showToast({icon:"none",title:n.message})})).catch((function(e){t.showToast({icon:"none",title:e.message})}))},fnShowShare:function(){var t=this;this.poster.show=!0,setTimeout((function(){t.poster.showCanvas=!0,t.fnCreatePoster((function(e){t.poster.res=e}))}),500)},drawDashedLine:function(t,e,n,o,a,i,r){t.lineWidth=a,t.strokeStyle=r,t.beginPath(),t.setLineDash(i),t.moveTo(e,n),t.lineTo(o,n),t.stroke(),n+=20},fnCreatePoster:function(e){var n=this;this.$nextTick((0,i.default)(a.default.mark((function o(){var i,r;return a.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,t.getSystemInfoSync();case 2:return o.sent,i=n.$utils.checkAvatarUrl(n.bloggerInfo.avatar,!0),r=n.$utils.checkThumbnailUrl(n.result.thumbnail,!0),o.next=7,n.$refs.rCanvas.init({canvas_id:"rCanvas",canvas_width:337,canvas_height:460,background_color:"rgba(255,255,255,0)"});case 7:return o.next=9,n.$refs.rCanvas.fillRoundRect({x:0,y:0,w:337,h:460,radius:12,fill_color:"#fff"}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 9:return o.next=11,n.$refs.rCanvas.drawImage({url:i,x:12,y:12,w:48,h:48,border_radius:24}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 11:return o.next=13,n.$refs.rCanvas.drawText({text:n.bloggerInfo.nickname,max_width:0,x:70,y:30,font_color:"#000",font_size:15}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 13:return o.next=15,n.$refs.rCanvas.drawText({text:n.bloggerInfo.description,max_width:0,x:70,y:52,font_color:"#666",font_size:12}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 15:return o.next=17,n.$refs.rCanvas.drawImage({url:r,x:12,y:75,w:312,h:180,border_radius:6}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 17:return o.next=19,n.$refs.rCanvas.drawText({text:n.result.title,max_width:312,line_clamp:1,x:12,y:285,font_weight:"bold",font_color:"#333",font_size:14}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 19:return o.next=21,n.$refs.rCanvas.drawText({text:n.result.summary,max_width:312,line_clamp:2,x:12,y:310,font_color:"#333",font_size:13,line_height:20}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 21:return n.drawDashedLine(n.$refs.rCanvas.ctx,14,356,332,.5,[8,5,5,5],"#999"),o.next=24,n.$refs.rCanvas.drawImage({url:n.$haloConfig.miniCodeImageUrl,x:20,y:360,w:80,h:80}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 24:return o.next=26,n.$refs.rCanvas.drawText({text:"长按识别小程序",x:150,y:390,font_color:"#333",font_size:15,font_weight:"bold",line_height:22}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 26:return o.next=28,n.$refs.rCanvas.drawText({text:"关注我，给你分享更多有趣的知识",x:115,y:425,font_color:"#333",font_size:12,line_height:22}).catch((function(e){t.showToast({title:e,icon:"none"})}));case 28:return o.next=30,n.$refs.rCanvas.draw((function(t){n.poster.loading=!1,e(t)}));case 30:case"end":return o.stop()}}),o)}))))},fnOnPosterClose:function(){this.poster.show=!1,this.poster.showCanvas=!1,this.poster.loading=!0},fnSavePoster:function(){this.$refs.rCanvas.saveImage(this.poster.res.tempFilePath)},fnShareTo:function(){t.$tm.toast("点击右上角分享给好友！")},fnOnShowCommentDetail:function(t){var e=t.postId,n=t.comment;this.commentDetail.comment=n,this.commentDetail.postId=e,this.commentDetail.list=[],this.commentDetail.show=!0,this.fnGetChildComments()},fnGetChildComments:function(){var t=this;this.commentDetail.loading="loading",this.$httpApi.getPostChildrenCommentList(this.commentDetail.postId,this.commentDetail.comment.id,{}).then((function(e){200==e.status?(t.commentDetail.loading="success",t.commentDetail.list=e.data):t.commentDetail.loading="error",console.log("getPostChildrenCommentList",e)})).catch((function(e){t.commentDetail.loading="error"}))},fnToCate:function(e){t.navigateTo({url:"/pagesA/category-detail/category-detail?slug=".concat(e.slug,"&name=").concat(e.name)})},fnToTag:function(e){t.navigateTo({url:"/pagesA/tag-detail/tag-detail?id=".concat(e.id,"&slug=").concat(e.slug,"&name=").concat(e.name)})},fnOnCommentLoaded:function(t){var e=this;return(0,i.default)(a.default.mark((function n(){var o,i,r,c,s;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=[],i=function t(e){return new Promise((function(n){0==e.length?n():e.forEach((function(e){o.push(e),e.children&&0!=e.children.length&&t(e.children),n()}))}))},n.next=4,i(t);case 4:e.globalAppSettings.barrage.use&&e.$nextTick((function(){0!=o.length&&s()})),r=function(){e.$refs["barrage"].remove({duration:5e3,speed:600})},c=0,s=function t(){setTimeout((function(){e.$refs["barrage"].add(o[c]),c+=1,c<o.length-1?t():r()}),1e3)};case 8:case"end":return n.stop()}}),n)})))()},fnToWebview:function(e){t.navigateTo({url:"/pagesC/website/website?data="+JSON.stringify({title:e.title,url:e.url})})},onShareAppMessage:function(t){Page({onShareAppMessage:function(t){return"menu"===t.from&&console.log(t.target),{title:"自定义转发标题",path:"/pagesA/article-detail/article-detail",success:function(t){},fail:function(t){}}}})}}};e.default=c}).call(this,n("543d")["default"])},"2ac2":function(t,e,n){},"3ef9":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}));var o={barrage:function(){return Promise.all([n.e("common/vendor"),n.e("components/barrage/barrage")]).then(n.bind(null,"57dc"))},commentItem:function(){return n.e("components/comment-item/comment-item").then(n.bind(null,"7cdb"))},rCanvas:function(){return Promise.all([n.e("common/vendor"),n.e("components/r-canvas/r-canvas")]).then(n.bind(null,"6c00"))}},a=function(){var t=this,e=t.$createElement,n=(t._self._c,"success"==t.loading?t._f("formatTime")({d:t.result.createTime,f:"yyyy年MM月dd日 星期w"}):null),o="success"==t.loading&&t.result.thumbnail?t.calcUrl(t.result.thumbnail):null,a="success"==t.loading?t.result.categories.length:null,i="success"==t.loading?t.result.tags.length:null,r="success"==t.commentDetail.loading?t.commentDetail.list.length:null;t.$mp.data=Object.assign({},{$root:{f0:n,m0:o,g0:a,g1:i,g2:r}})},i=[]},"52a7":function(t,e,n){"use strict";var o=n("2ac2"),a=n.n(o);a.a},"8c84":function(t,e,n){"use strict";(function(t,e){var o=n("4ea4");n("1ea4");o(n("66fd"));var a=o(n("e494"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(a.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},e494:function(t,e,n){"use strict";n.r(e);var o=n("3ef9"),a=n("0dde");for(var i in a)["default"].indexOf(i)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(i);n("52a7");var r=n("f0c5"),c=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,"91088f72",null,!1,o["a"],void 0);e["default"]=c.exports}},[["8c84","common/runtime","common/vendor"]]]);