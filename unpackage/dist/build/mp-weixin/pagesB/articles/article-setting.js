(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesB/articles/article-setting"],{"1a1e":function(t,e,n){"use strict";var i=n("3b5f"),o=n.n(i);o.a},"3b5f":function(t,e,n){},"666c":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;n("2393");var i={components:{tmButton:function(){n.e("tm-vuetify/components/tm-button/tm-button").then(function(){return resolve(n("9bbf"))}.bind(null,n)).catch(n.oe)},tmTabs:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-tabs/tm-tabs")]).then(function(){return resolve(n("61fe"))}.bind(null,n)).catch(n.oe)},tmForm:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-form/tm-form")]).then(function(){return resolve(n("77a7"))}.bind(null,n)).catch(n.oe)},tmGroupcheckbox:function(){n.e("tm-vuetify/components/tm-groupcheckbox/tm-groupcheckbox").then(function(){return resolve(n("75d3"))}.bind(null,n)).catch(n.oe)},tmCheckbox:function(){n.e("tm-vuetify/components/tm-checkbox/tm-checkbox").then(function(){return resolve(n("0b42"))}.bind(null,n)).catch(n.oe)},tmPickers:function(){n.e("tm-vuetify/components/tm-pickers/tm-pickers").then(function(){return resolve(n("c426"))}.bind(null,n)).catch(n.oe)},tmInput:function(){n.e("tm-vuetify/components/tm-input/tm-input").then(function(){return resolve(n("7908"))}.bind(null,n)).catch(n.oe)},tmPickersDate:function(){n.e("tm-vuetify/components/tm-pickersDate/tm-pickersDate").then(function(){return resolve(n("5698"))}.bind(null,n)).catch(n.oe)},tmPoup:function(){n.e("tm-vuetify/components/tm-poup/tm-poup").then(function(){return resolve(n("2b9f"))}.bind(null,n)).catch(n.oe)},tmSkeleton:function(){n.e("tm-vuetify/components/tm-skeleton/tm-skeleton").then(function(){return resolve(n("3f1b"))}.bind(null,n)).catch(n.oe)},tmEmpty:function(){n.e("tm-vuetify/components/tm-empty/tm-empty").then(function(){return resolve(n("947c"))}.bind(null,n)).catch(n.oe)},tmSwitch:function(){n.e("tm-vuetify/components/tm-switch/tm-switch").then(function(){return resolve(n("04fb"))}.bind(null,n)).catch(n.oe)},AttachmentSelect:function(){Promise.all([n.e("common/vendor"),n.e("components/attachment-select/attachment-select")]).then(function(){return resolve(n("eccf"))}.bind(null,n)).catch(n.oe)}},data:function(){return{isBlackTheme:!1,loading:"loading",uploadAvatarShow:!1,attachmentsSelectShow:!1,postsId:void 0,postTitle:void 0,createTime:void 0,isEdit:!0,from:"list",topPriority:!1,sfList:[{title:"是",checked:null},{title:"否",checked:null}],tab:{activeIndex:0,list:["常规","高级","SEO"]},article:{title:"",slug:"",status:"",content:"",keepRaw:!0,topPriority:0,summary:"",password:"",originalContent:"",metaDescription:"",formatContent:"",editorType:"MARKDOWN",createTime:"",categoryIds:[],tagIds:[]},articleStatus:{list:[{name:"发布",value:"PUBLISHED"},{name:"私有",value:"INTIMATE"},{name:"草稿",value:"DRAFT"},{name:"回收站",value:"RECYCLE"}],status:["PUBLISHED"],selectText:"发布",selectValue:"PUBLISHED"},categories:[],catePoupShow:!1,cateForm:{name:void 0,slug:void 0,password:void 0,description:void 0},tags:[],tagPoupShow:!1,tagForm:{name:void 0,slug:void 0}}},onLoad:function(e){var n=this.$Route.query.postsId,i=this.$Route.query.postTitle,o=this.$Route.query.isEdit,a=this.$Route.query.from;this.postsId=n,this.postTitle=i||"",this.isEdit=1==o,this.from=a,this.createTime=t.$tm.dayjs((new Date).getTime()).format("YYYY-MM-DD HH:mm:ss"),this.fnGetSettings()},onPullDownRefresh:function(){0!=this.isEdit?this.fnGetSettings():t.stopPullDownRefresh()},methods:{fnOnCatePoupChange:function(t){t||this.fnResetCateForm()},fnResetCateForm:function(){this.cateForm={color:void 0,createTime:void 0,fullPath:void 0,id:void 0,name:"",slug:void 0,thumbnail:void 0,showThumbnail:void 0}},fnOnCatePoupHide:function(){this.catePoupShow=!1,this.fnResetCateForm()},fnOnCateSave:function(){var e=this;if(""==this.cateForm.name.trim())return t.$tm.toast("分类名称未填写！");this.$httpApi.admin.createCategory(this.cateForm).then((function(n){200==n.status?(t.$tm.toast("保存成功！"),e.fnResetCateForm(),e.categories.push({id:n.data.id,name:n.data.name,checked:!1})):t.$tm.toast("添加成功！")})).catch((function(e){t.$tm.toast("添加失败，请重试！")}))},fnOnTagPoupChange:function(t){t||this.fnResetTagForm()},fnResetTagForm:function(){this.tagForm={color:void 0,createTime:void 0,fullPath:void 0,id:void 0,name:"",slug:void 0,thumbnail:void 0,showThumbnail:void 0}},fnOnTagPoupHide:function(){this.tagPoupShow=!1,this.fnResetTagForm()},fnOnTagSave:function(){var e=this;if(""==this.tagForm.name.trim())return t.$tm.toast("标签名称未填写！");this.$httpApi.admin.createTags(this.tagForm).then((function(n){200==n.status?(t.$tm.toast("保存成功！"),e.fnResetTagForm(),e.tags.push({id:n.data.id,name:n.data.name,checked:!1})):t.$tm.toast("添加成功！")})).catch((function(e){t.$tm.toast("添加失败，请重试！")}))},fnOnArticleStatusConfirm:function(t){var e=t[0].data;this.articleStatus.status=[e.value],this.articleStatus.selectText=e.name,this.articleStatus.selectValue=e.value},fnGetSettings:function(){var e=this;this.loading="success";var n=this.isEdit?this.$httpApi.admin.getPostsById(this.postsId):Promise.resolve(),i=this.$httpApi.admin.getCategoryList({more:!0}),o=this.$httpApi.admin.getTagsList({more:!0}),a=Promise.all([n,i,o]);t.showLoading({title:"加载中，请稍等...",mask:!0}),a.then((function(n){if(e.isEdit){var i=n[0];e.article=i.data;var o=e.articleStatus.list.find((function(t){return t.value==e.article.status}));o&&(e.articleStatus.status=[o.value],e.articleStatus.selectText=o.name,e.articleStatus.selectValue=o.value),e.topPriority=0!=e.article.topPriority,e.article.thumbnail&&e.$set(e.article,"showThumbnail",e.$utils.checkThumbnailUrl(e.article.thumbnail)),e.createTime=t.$tm.dayjs(new Date(e.article.createTime).getTime()).format("YYYY-MM-DD HH:mm:ss"),e.postTitle&&e.$set(e.article,"title",e.postTitle)}var a=n[1],s=a.data.map((function(t,n){var i=!1;return e.isEdit&&(i=e.article.categoryIds.some((function(e){return e==t.id}))),{index:i?0:n+1,id:t.id,name:t.name,checked:i}}));e.isEdit?e.categories=s.sort((function(t,e){return t.index-e.index})):e.categories=s;var c=n[2],r=c.data.map((function(t,n){var i=!1;return e.isEdit&&(i=e.article.tagIds.some((function(e){return e==t.id}))),{index:i?0:n+1,id:t.id,name:t.name,checked:i}}));e.isEdit?e.tags=r.sort((function(t,e){return t.index-e.index})):e.tags=r,e.loading="success",t.hideLoading()})).catch((function(t){e.$tm.toast("数据加载失败，请重试！"),e.loading="error"})).finally((function(){t.stopPullDownRefresh()}))},fnOnAttachmentsSelect:function(t){this.article.thumbnail=t.path,this.$set(this.article,"showThumbnail",this.$utils.checkThumbnailUrl(t.path)),this.attachmentsSelectShow=!1},fnOnConfirmPublishTime:function(t){this.createTime="".concat(t.year,"-").concat(t.month,"-").concat(t.day," 00:00:00"),this.article.createTime=new Date("".concat(t.year,"-").concat(t.month,"-").concat(t.day)).getTime()},fnOnChangeStatus:function(t){"INTIMATE"==this.article.status&&(this.article["password"]=""),this.article.status=t,this.fnOnSave(!0)},fnOnChangeCreateStatus:function(t){this.article.status=t,this.fnOnSave()},fnOnSave:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.article.title?this.article.slug?"INTIMATE"!=this.articleStatus.selectValue||this.article.password?(t.showLoading({title:"保存中...",mask:!0}),"edit"==this.from&&(this.article.content=t.getStorageSync("posts-content"),this.article.formatContent=t.getStorageSync("posts-content"),this.article.originalContent=t.getStorageSync("posts-content-source")),"INTIMATE"!=this.articleStatus.selectValue&&(this.article.password=""),this.article.status=this.articleStatus.selectValue,this.article.topPriority=this.topPriority?1:0,this.article.tagIds=this.tags.filter((function(t){return 1==t.checked})).map((function(t){return t.id})),this.article.categoryIds=this.categories.filter((function(t){return 1==t.checked})).map((function(t){return t.id})),void(this.isEdit?this.$httpApi.admin.updatePostsById(this.postsId,this.article).then((function(o){200==o.status?(e.$tm.toast("保存成功！"),t.setStorageSync("posts-html-edit",""),t.setStorageSync("posts-content",""),t.setStorageSync("posts-content-source",""),setTimeout((function(){i&&t.navigateBack({delta:1})}),1e3)):(t.$tm.toast("保存失败，请重试!"),n&&(e.article.status="DRAFT"==e.article.status?"PUBLISHED":"DRAFT"))})).catch((function(i){t.$tm.toast("保存失败，".concat(i.message,"!")),n&&(e.article.status="DRAFT"==e.article.status?"PUBLISHED":"DRAFT")})):this.$httpApi.admin.createPosts(this.article).then((function(e){200==e.status?(t.$tm.toast("发布成功!"),t.setStorageSync("posts-html-edit",""),t.setStorageSync("posts-content",""),t.setStorageSync("posts-content-source",""),setTimeout((function(){t.navigateBack({delta:2}),t.$emit("refresh-article-list")}),1e3)):t.$tm.toast("发布失败，请重试!")})).catch((function(e){t.$tm.toast("发布失败：".concat(e.message))})))):t.$tm.toast("文章私有状态，缺少密码！"):t.$tm.toast("请输入文章别名！"):t.$tm.toast("请输入文章标题！")},fnOnBack:function(){t.$eShowModal({title:"提示",content:"您当前可能有未保存的数据，确定返回吗？",showCancel:!0,cancelText:"否",cancelColor:"#999999",confirmText:"是",confirmColor:"#03a9f4"}).then((function(e){t.navigateBack()})).catch((function(t){}))}}};e.default=i}).call(this,n("543d")["default"])},"7f11":function(t,e,n){"use strict";n.r(e);var i=n("add7"),o=n("e213");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("1a1e");var s=n("f0c5"),c=Object(s["a"])(o["default"],i["b"],i["c"],!1,null,"fb39b5ca",null,!1,i["a"],void 0);e["default"]=c.exports},add7:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={attachmentSelect:function(){return Promise.all([n.e("common/vendor"),n.e("components/attachment-select/attachment-select")]).then(n.bind(null,"eccf"))}},o=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.catePoupShow=!0},t.e1=function(e){t.tagPoupShow=!0},t.e2=function(e){t.attachmentsSelectShow=!0},t.e3=function(e){t.attachmentsSelectShow=!0},t.e4=function(e){t.attachmentsSelectShow=!1})},a=[]},e213:function(t,e,n){"use strict";n.r(e);var i=n("666c"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},f7b1:function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("1ea4");i(n("66fd"));var o=i(n("7f11"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])}},[["f7b1","common/runtime","common/vendor"]]]);