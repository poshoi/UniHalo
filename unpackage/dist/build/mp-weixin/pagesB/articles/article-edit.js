(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesB/articles/article-edit"],{"0ac8":function(t,e,n){"use strict";n.r(e);var o=n("7f1f"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a},"35e0":function(t,e,n){"use strict";n.r(e);var o=n("ed1e"),i=n("0ac8");for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("6ecd");var c=n("f0c5"),r=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,"a3093292",null,!1,o["a"],void 0);e["default"]=r.exports},"535d":function(t,e,n){"use strict";(function(t,e){var o=n("4ea4");n("1ea4");o(n("66fd"));var i=o(n("35e0"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"6ecd":function(t,e,n){"use strict";var o=n("8873"),i=n.n(o);i.a},"7f1f":function(t,e,n){"use strict";(function(t,o){var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(n("2eee")),c=i(n("c973")),r=n("2393"),s=i(n("1c22"));function l(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var o=0,i=function(){};return{s:i,n:function(){return o>=t.length?{done:!0}:{done:!1,value:t[o++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,r=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return c=t.done,t},e:function(t){r=!0,a=t},f:function(){try{c||null==n.return||n.return()}finally{if(r)throw a}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var f={components:{mpHtml:function(){Promise.all([n.e("common/vendor"),n.e("components/mp-html/components/mp-html/mp-html")]).then(function(){return resolve(n("a79e"))}.bind(null,n)).catch(n.oe)},tmSkeleton:function(){n.e("tm-vuetify/components/tm-skeleton/tm-skeleton").then(function(){return resolve(n("3f1b"))}.bind(null,n)).catch(n.oe)},tmButton:function(){n.e("tm-vuetify/components/tm-button/tm-button").then(function(){return resolve(n("9bbf"))}.bind(null,n)).catch(n.oe)},tmEmpty:function(){n.e("tm-vuetify/components/tm-empty/tm-empty").then(function(){return resolve(n("947c"))}.bind(null,n)).catch(n.oe)},tmTranslate:function(){n.e("tm-vuetify/components/tm-translate/tm-translate").then(function(){return resolve(n("c684"))}.bind(null,n)).catch(n.oe)},tmFlotbutton:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-flotbutton/tm-flotbutton")]).then(function(){return resolve(n("1902"))}.bind(null,n)).catch(n.oe)},tmSwitch:function(){n.e("tm-vuetify/components/tm-switch/tm-switch").then(function(){return resolve(n("04fb"))}.bind(null,n)).catch(n.oe)},tmPoup:function(){n.e("tm-vuetify/components/tm-poup/tm-poup").then(function(){return resolve(n("2b9f"))}.bind(null,n)).catch(n.oe)},tmInput:function(){n.e("tm-vuetify/components/tm-input/tm-input").then(function(){return resolve(n("7908"))}.bind(null,n)).catch(n.oe)},attachmentSelect:function(){Promise.all([n.e("common/vendor"),n.e("components/attachment-select/attachment-select")]).then(function(){return resolve(n("eccf"))}.bind(null,n)).catch(n.oe)}},data:function(){return{loading:"loading",markdownConfig:s.default,queryParams:{postsId:void 0},status:!0,form:{content:"",keepRaw:!0,originalContent:"",formatContent:"",type:"PUBLIC"},modal:null,editable:!0,attachmentsSelect:{title:"选择附件",show:!1},dialog:{show:!1,type:""},emojis:[["😄","😷","😂","😝","😳","😱","😔","😒","😉"],["😎","😭","😍","😘","🤔","😕","🙃","🤑","😲"],["🙄","😤","😴","🤓","😡","😑","😮","🤒","🤮"]],templates:['<section style="text-align: center; margin: 0px auto;"><section style="border-radius: 4px; border: 1px solid #757576; display: inline-block; padding: 5px 20px;"><span style="font-size: 18px; color: #595959;">标题</span></section></section>','<div style="width: 100%; box-sizing: border-box; border-radius: 5px; background-color: #f6f6f6; padding: 10px; margin: 10px 0"><div>卡片</div><div style="font-size: 12px; color: gray">正文</div></div>','<div style="border: 1px solid gray; box-shadow: 3px 3px 0px #cfcfce; padding: 10px; margin: 10px 0">段落</div>']}},onLoad:function(){var e=this.$Route.query.postsId;void 0==e?(this.fnSetPageTitle("新增文章"),this.form.content=t.getStorageSync("posts-content")):(this.fnSetPageTitle("编辑文章"),this.queryParams.postsId=e,this.fnGetData())},onReady:function(){var e=this;this.$refs.markdown.getSrc=function(n,i){return new Promise((function(r,s){e.checkEditable().then((function(u){var f;"img"===n||"video"===n?t.showActionSheet({itemList:["本地选取","附件选取"],success:function(u){0===u.tapIndex?"img"===n?t.chooseImage({count:void 0===i?9:1,success:function(i){1==i.tempFilePaths.length&&o.editImage?o.editImage({src:i.tempFilePaths[0],complete:function(o){t.showLoading({title:"上传中"}),e.fnFileUpload(o.tempFilePath||i.tempFilePaths[0],n).then((function(e){t.hideLoading(),r(e)}))}}):(t.showLoading({title:"上传中"}),(0,c.default)(a.default.mark((function t(){var o,c,r,s,u;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=[],c=l(i.tempFilePaths),t.prev=2,c.s();case 4:if((r=c.n()).done){t.next=12;break}return s=r.value,t.next=8,e.fnFileUpload(s,n);case 8:u=t.sent,o.push(u);case 10:t.next=4;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](2),c.e(t.t0);case 17:return t.prev=17,c.f(),t.finish(17);case 20:return t.abrupt("return",o);case 21:case"end":return t.stop()}}),t,null,[[2,14,17,20]])})))().then((function(e){t.hideLoading(),r(e)})))},fail:s}):t.chooseVideo({success:function(o){t.showLoading({title:"上传中"}),e.fnFileUpload(o.tempFilePath,n).then((function(e){t.hideLoading(),r(e)}))},fail:s}):(e.callback={resolve:r,reject:s},e.attachmentsSelect.title="img"===n?"选取图片":"选取视频",e.attachmentsSelect.show=!0)}}):(e.callback={resolve:r,reject:s},"audio"===n?f="音频链接":"link"===n&&(f="链接地址"),e.$set(e,"modal",{title:f,type:"link",value:i}))})).catch((function(t){}))}))}},methods:{fnGetData:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.loading="loading",t.showLoading({mask:!0,title:"加载中..."}),this.$httpApi.admin.getPostsById(this.queryParams.postsId).then((function(o){200==o.status?(e.fnSetPageTitle("正在编辑 ".concat(o.data.title)),e.$set(e,"form",o.data),n&&e.$nextTick((function(){e.$refs.markdown.setContent(o.data.content)})),e.loading="success",t.hideLoading()):(e.loading="error",e.fnSetPageTitle("文章加载失败"),t.$tm.toast("文章加载失败，请点击下方重新加载!"))})).catch((function(n){console.error(n),e.loading="error",e.fnSetPageTitle("文章加载失败"),t.$tm.toast("文章加载失败，请点击下方重新加载!")}))},fnRefreshData:function(){var e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];n?t.$eShowModal({title:"提示",content:"您当前的编辑可能未保存，确定要重新加载吗？",showCancel:!0,cancelText:"否",cancelColor:"#999999",confirmText:"是",confirmColor:"#03a9f4"}).then((function(t){e.fnGetData(!0)})).catch((function(t){})):this.fnGetData(!0)},checkEditable:function(){var e=this;return new Promise((function(n,o){e.editable?n():t.showModal({title:"提示",content:"需要继续编辑吗？",success:function(t){t.confirm?(e.editable=!0,n()):o()}})}))},fnOnToolBarEdit:function(t){this.$refs.markdown[t.currentTarget.dataset.method](t.currentTarget.dataset.param)},fnOnAttachmentsSelect:function(t){this.attachmentsSelect.show=!1,this.callback.resolve(t.path)},modalInput:function(t){this.value=t.detail.value},modalConfirm:function(){if("table"==this.modal.type){if(this.modal.rows<=0)return t.$tm.toast("行数必须大于0");if(this.modal.cols<=0)return t.$tm.toast("列数必须大于0")}this.callback.resolve(this.value||this.modal.value||""),this.$set(this,"modal",null)},modalCancel:function(){this.callback.reject(),this.$set(this,"modal",null)},fnFileUpload:function(e,n){var o=this;return new Promise((function(n,i){t.uploadFile({filePath:e,header:{"admin-authorization":(0,r.getAdminAccessToken)()},url:o.$baseApiUrl+"/api/admin/attachments/upload",name:"file",success:function(e){var o=JSON.parse(e.data);200==o.status?n(o.data.path):(t.$tm.toast(o.message),i())},fail:function(e){t.$tm.toast(e.message),i()}})}))},fnOnInsertHead:function(){var t=this;this.checkEditable().then((function(){var e=["h1","h2","h3","h4","h5","h6"];o.showActionSheet({itemList:e,success:function(n){var o=e[n.tapIndex];t.$refs.markdown.insertHtml("<".concat(o,">标题</").concat(o,">"))}})})).catch((function(){}))},fnOnInsertTable:function(){var t=this;this.checkEditable().then((function(){t.$set(t,"modal",{title:"插入表格",type:"table",rows:1,cols:1,value:t.value}),t.callback={resolve:function(){t.$refs.markdown.insertTable(t.modal.rows,t.modal.cols)},reject:function(){}}})).catch((function(){}))},fnOnSaveInsertTable:function(){this.callback.resolve(this.value||this.modal.value||"")},fnOnInsertCode:function(){var e=this;this.checkEditable().then((function(){t.showActionSheet({itemList:["html","css","javascript","json"],success:function(t){var n=["html","css","javascript","json"][t.tapIndex];e.$refs.markdown.insertHtml('<pre><code class="language-'.concat(n,'">').concat(n," code</code></pre>"))}})})).catch((function(){}))},fnOnInsertEmoji:function(t){this.$refs.markdown.insertHtml(t.currentTarget.dataset.emoji),this.fnOnCloseDialog()},fnOnOpenDialog:function(t){var e=this;this.checkEditable().then((function(){e.dialog.type=t.currentTarget.dataset.type,e.dialog.title=t.currentTarget.dataset.title,e.dialog.show=!0})).catch((function(){}))},fnOnCloseDialog:function(t){0==t&&(this.dialog.show=!1,this.dialog.type="")},fnOnPreview:function(){if(this.editable=!this.editable,this.editable)t.$tm.toast("您已进入编辑模式！");else{t.$tm.toast("您已进入预览模式！");var e=this.$refs.markdown.getContent();"<p></p>"===e&&(e=""),this.form.content=e,t.setStorageSync("posts-content",e)}},fnSaveAtPublish:function(){t.showLoading({mask:!0,title:"保存中..."});var e=this.$refs.markdown.getContent();if(!e.trim())return t.$tm.toast("请输入内容!");this.form.content=e,this.form.formatContent=e,this.form.originalContent=this.$refs.markdown.getText(),t.setStorageSync("posts-content",e),t.setStorageSync("posts-content-source",this.form.originalContent),this.form.id?this.$Router.push({path:"/pagesB/articles/article-setting",query:{postsId:this.form.id,postTitle:this.form.title,isEdit:1,from:"edit"}}):this.$Router.push({path:"/pagesB/articles/article-setting",query:{postsId:"",postTitle:"",isEdit:0,from:"edit"}})},fnClear:function(){var e=this;t.$eShowModal({title:"提示",content:"确定清空当前内容吗？",showCancel:!0,cancelText:"否",cancelColor:"#999999",confirmText:"是",confirmColor:"#03a9f4"}).then((function(n){e.$refs.markdown.clear(),t.setStorageSync("posts-content",""),t.setStorageSync("posts-content-source",""),e.fnToTopPage()})).catch((function(){}))}}};e.default=f}).call(this,n("543d")["default"],n("bc2e")["default"])},8873:function(t,e,n){},ed1e:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}));var o={attachmentSelect:function(){return Promise.all([n.e("common/vendor"),n.e("components/attachment-select/attachment-select")]).then(n.bind(null,"eccf"))}},i=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.attachmentsSelect.show=!1})},a=[]}},[["535d","common/runtime","common/vendor"]]]);