(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesB/attachment/attachment"],{1338:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,n=(t._self._c,"success"==t.loading?t.dataList.length:null),i="success"==t.loading&&0!=n?t.__map(t.dataList,(function(e,n){var i=t.__get_orig(e),o=t.fnGetIconClass(e.mediaType),a=t._f("formatTime")({d:e.createTime,f:"yyyy年MM月dd日 星期w"});return{$orig:i,m0:o,f0:a}})):null,o="success"==t.loading?t.$utils.fnCheckIsFileType("image",t.detail.form):null,a="success"==t.loading&&o?t.$utils.checkThumbnailUrl(t.detail.form.path):null,c="success"!=t.loading||o?null:t.$utils.fnCheckIsFileType("video",t.detail.form),s="success"==t.loading&&!o&&c?t.$utils.checkUrl(t.detail.form.path):null;t._isMounted||(t.e0=function(e){return t.$utils.copyText(t.detail.form.path,"复制成功！")},t.e1=function(e){t.detail.show=!1}),t.$mp.data=Object.assign({},{$root:{g0:n,l0:i,g1:o,g2:a,g3:c,g4:s}})},o=[]},1795:function(t,e,n){},"504b":function(t,e,n){"use strict";n.r(e);var i=n("1338"),o=n("ca76");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("f9cb");var c=n("f0c5"),s=Object(c["a"])(o["default"],i["b"],i["c"],!1,null,"e6093836",null,!1,i["a"],void 0);e["default"]=s.exports},6332:function(t,e,n){"use strict";(function(t){var i=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("9523")),a=n("2393");function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){(0,o.default)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var r={components:{tmSkeleton:function(){n.e("tm-vuetify/components/tm-skeleton/tm-skeleton").then(function(){return resolve(n("3f1b"))}.bind(null,n)).catch(n.oe)},tmSearch:function(){n.e("tm-vuetify/components/tm-search/tm-search").then(function(){return resolve(n("af77"))}.bind(null,n)).catch(n.oe)},tmDropDownMenu:function(){n.e("tm-vuetify/components/tm-dropDownMenu/tm-dropDownMenu").then(function(){return resolve(n("7c15"))}.bind(null,n)).catch(n.oe)},tmEmpty:function(){n.e("tm-vuetify/components/tm-empty/tm-empty").then(function(){return resolve(n("947c"))}.bind(null,n)).catch(n.oe)},tmButton:function(){n.e("tm-vuetify/components/tm-button/tm-button").then(function(){return resolve(n("9bbf"))}.bind(null,n)).catch(n.oe)},tmCheckbox:function(){n.e("tm-vuetify/components/tm-checkbox/tm-checkbox").then(function(){return resolve(n("0b42"))}.bind(null,n)).catch(n.oe)},tmPoup:function(){n.e("tm-vuetify/components/tm-poup/tm-poup").then(function(){return resolve(n("2b9f"))}.bind(null,n)).catch(n.oe)},tmForm:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-form/tm-form")]).then(function(){return resolve(n("77a7"))}.bind(null,n)).catch(n.oe)},tmUpload:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-upload/tm-upload")]).then(function(){return resolve(n("3741"))}.bind(null,n)).catch(n.oe)},tmInput:function(){n.e("tm-vuetify/components/tm-input/tm-input").then(function(){return resolve(n("7908"))}.bind(null,n)).catch(n.oe)},tmImages:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-images/tm-images")]).then(function(){return resolve(n("15db"))}.bind(null,n)).catch(n.oe)},tmFlotbutton:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-flotbutton/tm-flotbutton")]).then(function(){return resolve(n("1902"))}.bind(null,n)).catch(n.oe)},tmTranslate:function(){n.e("tm-vuetify/components/tm-translate/tm-translate").then(function(){return resolve(n("c684"))}.bind(null,n)).catch(n.oe)},tmActionSheetMenu:function(){n.e("tm-vuetify/components/tm-actionSheetMenu/tm-actionSheetMenu").then(function(){return resolve(n("d6a0"))}.bind(null,n)).catch(n.oe)}},data:function(){return{loading:"loading",filterLoading:"loading",btnOption:{actions:[{icon:"icon-like",color:"bg-gradient-orange-accent"},{icon:"icon-commentdots-fill",color:"bg-gradient-green-accent"},{icon:"icon-share1",color:"bg-gradient-blue-accent"}]},filterList:[{title:"存储位置",children:[{title:"",name:"attachmentType",model:"radio",children:[]}]},{title:"文件类型",children:[{title:"",name:"mediaType",model:"radio",children:[]}]}],queryParams:{size:8,page:0,attachmentType:void 0,keyword:void 0,mediaType:void 0,sort:void 0},result:{},dataList:[],total:0,detail:{params:{},form:{},show:!1},isLoadMore:!1,loadMoreText:"加载中...",fileSelectAction:{show:!1,list:[]}}},onLoad:function(){this.fnSetPageTitle("附件管理")},created:function(){this.fnGetData(),this.fnGetFilters()},onPullDownRefresh:function(){this.queryParams.page=0,this.dataList=[],this.fnGetData(),"success"!=this.filterLoading&&this.fnGetFilters()},onReachBottom:function(e){this.result.hasNext?(this.queryParams.page+=1,this.isLoadMore=!0,this.fnGetData()):t.showToast({icon:"none",title:"没有更多数据了"})},methods:{fnTransFileSize:function(t){return t?t<this.fnPow1024(1)?t+" B":t<this.fnPow1024(2)?(t/this.fnPow1024(1)).toFixed(2)+" KB":t<this.fnPow1024(3)?(t/this.fnPow1024(2)).toFixed(2)+" MB":t<this.fnPow1024(4)?(t/this.fnPow1024(3)).toFixed(2)+" GB":(t/this.fnPow1024(4)).toFixed(2)+" TB":""},fnPow1024:function(t){return Math.pow(1024,t)},fnGetIconClass:function(t){var e="";return-1!=t.indexOf("video/")?e="is-video":-1!=t.indexOf("image/")&&(e="is-image"),e},fnCheckIsFileType:function(t,e){return"video"==t?-1!=e.mediaType.indexOf("video/"):"image"==t&&-1!=e.mediaType.indexOf("image/")},fnGetFilters:function(){var e=this;this.filterLoading="loading",Promise.all([this.$httpApi.admin.getAttachmentsTypes(),this.$httpApi.admin.getAttachmentsMediaTypes()]).then((function(t){var n=t[0];e.filterList[0].children[0].children=n.data.map((function(t){return{title:t,id:t}}));var i=t[1];e.filterList[1].children[0].children=i.data.map((function(t){return{title:t,id:t}})),e.filterLoading="success"})).catch((function(n){e.filterLoading="error",t.$tm.toast("搜索条件数据加载失败！")}))},fnOnConfirm:function(t){this.queryParams.attachmentType=t[0].children.map((function(t){return t.id})).join("")||void 0,this.queryParams.mediaType=t[1].children.map((function(t){return t.id})).join("")||void 0,this.fnOnSearch()},fnOnSearch:function(){this.queryParams.page=0,this.dataList=[],this.fnGetData()},fnGetData:function(){var e=this;t.showLoading({mask:!0,title:"加载中..."}),this.isLoadMore||(this.loading="loading"),this.loadMoreText="加载中...",this.$httpApi.admin.getAttachmentsByPage(this.queryParams).then((function(n){if(200==n.status){if(e.loadMoreText=n.data.hasNext?"上拉加载更多":"呜呜，没有更多数据啦~",e.result=n.data,e.total=n.data.total,e.isLoadMore){var i=e.dataList.concat(n.data.content);e.dataList=i.map((function(t){return t["sizeText"]=e.fnTransFileSize(t.size),t}))}else e.dataList=n.data.content.map((function(t){return t["sizeText"]=e.fnTransFileSize(t.size),t}));e.loading="success"}else t.$tm.toast("加载失败，请重试！"),thi.loading="error"})).catch((function(n){console.error(n),t.$tm.toast("加载失败，请重试！"),e.loading="error",e.loadMoreText="加载失败，请下拉刷新！"})).finally((function(){setTimeout((function(){t.hideLoading(),t.stopPullDownRefresh()}),300)}))},fnShowDetail:function(t){this.detail.params=s({},t),this.detail.form=s({},t),this.detail.show=!0},fnOnDelete:function(){var e=this;t.$eShowModal({title:"提示",content:"您确定要删除该附件吗？",showCancel:!0,cancelText:"否",cancelColor:"#999999",confirmText:"是",confirmColor:"#03a9f4"}).then((function(n){t.showLoading({mask:!0,title:"正在删除..."}),e.$httpApi.admin.deleteAttachmentById(e.detail.params.id).then((function(n){200==n.status?(t.$tm.toast("删除成功！"),setTimeout((function(){e.detail.show=!1,e.detail.params={},e.detail.form={},e.fnGetData()}),1e3)):t.$tm.toast("删除失败，请重试！")})).catch((function(e){console.error(e),t.$tm.toast("删除失败，请重试！")}))})).catch((function(t){}))},fnOnUpdate:function(){if(""==this.detail.form.name)return t.$tm.toast("附件名称不能为空！");t.showLoading({mask:!0,title:"正在保存..."}),this.$httpApi.admin.updateAttachmentById(this.detail.params.id,this.detail.form.name).then((function(e){200==e.status?t.$tm.toast("保存成功！"):t.$tm.toast("保存失败，请重试！")})).catch((function(e){t.$tm.toast("保存失败，请重试！")}))},fnOnFlotButton:function(){this.fileSelectAction.list=["上传照片","上传视频","上传文件"],this.fileSelectAction.show=!0},fnOnFileSelectActionChange:function(e){var n=this;switch(e.index){case 0:t.chooseImage({count:1,success:function(t){console.log(t),n.fnOnUploadFileByPath(t.tempFilePaths[0])}});break;case 1:t.chooseVideo({count:1,success:function(t){console.log(t),n.fnOnUploadFileByPath(t.tempFilePath)}});break;case 2:t.chooseMessageFile({count:1,success:function(t){n.fnOnUploadFileByPath(t.tempFiles[0].path)}});break}},fnOnUploadFileByPath:function(e){var n=this;t.showLoading({title:"文件上传中...",mask:!0}),t.uploadFile({filePath:e,header:{"admin-authorization":(0,a.getAdminAccessToken)()},url:this.$baseApiUrl+"/api/admin/attachments/upload",name:"file",success:function(e){var i=JSON.parse(e.data);200==i.status?(t.$tm.toast("文件上传成功！"),setTimeout((function(){n.fnGetData()}),1e3)):t.$tm.toast(i.message)},fail:function(e){t.$tm.toast(e.message)}})},fnOnUploadFileByFile:function(e){var n=this;t.showLoading({title:"文件上传中...",mask:!0}),t.uploadFile({files:[e],header:{"admin-authorization":(0,a.getAdminAccessToken)()},url:this.$baseApiUrl+"/api/admin/attachments/upload",name:"file",success:function(e){var i=JSON.parse(e.data);200==i.status?(t.$tm.toast("文件上传成功！"),setTimeout((function(){n.fnGetData()}),1e3)):t.$tm.toast(i.message)},fail:function(e){t.$tm.toast(e.message)}})}}};e.default=r}).call(this,n("543d")["default"])},"830c":function(t,e,n){"use strict";(function(t,e){var i=n("4ea4");n("1ea4");i(n("66fd"));var o=i(n("504b"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(o.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},ca76:function(t,e,n){"use strict";n.r(e);var i=n("6332"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},f9cb:function(t,e,n){"use strict";var i=n("1795"),o=n.n(i);o.a}},[["830c","common/runtime","common/vendor"]]]);