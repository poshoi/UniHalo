(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pagesB/photos/photos"],{2022:function(t,e,n){"use strict";n.r(e);var o=n("bc2ee"),i=n("9b35");for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);n("8139");var s=n("f0c5"),c=Object(s["a"])(i["default"],o["b"],o["c"],!1,null,"02066674",null,!1,o["a"],void 0);e["default"]=c.exports},"578b":function(t,e,n){},8139:function(t,e,n){"use strict";var o=n("578b"),i=n.n(o);i.a},"81fe":function(t,e,n){"use strict";(function(t,e){var o=n("4ea4");n("1ea4");o(n("66fd"));var i=o(n("2022"));t.__webpack_require_UNI_MP_PLUGIN__=n,e(i.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},"9b35":function(t,e,n){"use strict";n.r(e);var o=n("e20e"),i=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e["default"]=i.a},bc2ee:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o}));var o={attachmentSelect:function(){return Promise.all([n.e("common/vendor"),n.e("components/attachment-select/attachment-select")]).then(n.bind(null,"eccf"))}},i=function(){var t=this,e=t.$createElement,n=(t._self._c,t.team.list.length),o=t.team.list.length,i="success"==t.loading?t.dataList.length:null,a="success"==t.loading&&0!=i?t.__map(t.dataList,(function(e,n){var o=t.__get_orig(e),i=t._f("formatTime")({d:e.takeTime,f:"yyyy年MM月dd日 星期w"});return{$orig:o,f0:i}})):null;t._isMounted||(t.e0=function(e){t.poupShow=!1}),t.$mp.data=Object.assign({},{$root:{g0:n,g1:o,g2:i,l0:a}})},a=[]},e20e:function(t,e,n){"use strict";(function(t){var o=n("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(n("9523")),a=o(n("3151")),s={components:{tmSkeleton:function(){n.e("tm-vuetify/components/tm-skeleton/tm-skeleton").then(function(){return resolve(n("3f1b"))}.bind(null,n)).catch(n.oe)},tmButton:function(){n.e("tm-vuetify/components/tm-button/tm-button").then(function(){return resolve(n("9bbf"))}.bind(null,n)).catch(n.oe)},tmSearch:function(){n.e("tm-vuetify/components/tm-search/tm-search").then(function(){return resolve(n("af77"))}.bind(null,n)).catch(n.oe)},tmTabs:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-tabs/tm-tabs")]).then(function(){return resolve(n("61fe"))}.bind(null,n)).catch(n.oe)},tmEmpty:function(){n.e("tm-vuetify/components/tm-empty/tm-empty").then(function(){return resolve(n("947c"))}.bind(null,n)).catch(n.oe)},tmFlotbutton:function(){Promise.all([n.e("common/vendor"),n.e("tm-vuetify/components/tm-flotbutton/tm-flotbutton")]).then(function(){return resolve(n("1902"))}.bind(null,n)).catch(n.oe)},tmTranslate:function(){n.e("tm-vuetify/components/tm-translate/tm-translate").then(function(){return resolve(n("c684"))}.bind(null,n)).catch(n.oe)},tmPoup:function(){n.e("tm-vuetify/components/tm-poup/tm-poup").then(function(){return resolve(n("2b9f"))}.bind(null,n)).catch(n.oe)},tmInput:function(){n.e("tm-vuetify/components/tm-input/tm-input").then(function(){return resolve(n("7908"))}.bind(null,n)).catch(n.oe)},tmPickersDate:function(){n.e("tm-vuetify/components/tm-pickersDate/tm-pickersDate").then(function(){return resolve(n("5698"))}.bind(null,n)).catch(n.oe)},tmPickers:function(){n.e("tm-vuetify/components/tm-pickers/tm-pickers").then(function(){return resolve(n("c426"))}.bind(null,n)).catch(n.oe)},AttachmentSelect:function(){Promise.all([n.e("common/vendor"),n.e("components/attachment-select/attachment-select")]).then(function(){return resolve(n("eccf"))}.bind(null,n)).catch(n.oe)}},data:function(){return{loading:"loading",team:{activeIndex:0,list:[],selected:[],selectList:[]},queryParams:(0,i.default)({size:10,page:0,sort:"createTime,desc"},"sort","id,asc"),result:null,dataList:[],total:0,isLoadMore:!1,loadMoreText:"加载中...",poupShow:!1,attachmentsSelectShow:!1,selectAttachmentsType:"url",takeTime:void 0,form:{id:void 0,location:void 0,name:void 0,takeTime:void 0,team:void 0,thumbnail:void 0,url:void 0,description:void 0},poupBodyScrollTop:0}},onLoad:function(){this.fnSetPageTitle("图库管理"),this.fnGetTeamList()},created:function(){this.fnGetData()},onPullDownRefresh:function(){this.queryParams.page=0,this.dataList=[],this.fnGetData()},onReachBottom:function(e){this.result.hasNext?(this.queryParams.page+=1,this.isLoadMore=!0,this.fnGetData()):t.showToast({icon:"none",title:"没有更多数据了"})},methods:{fnGetTeamList:function(){var t=this;this.$httpApi.admin.getPhotosTeams().then((function(e){if(200==e.status){var n=e.data;t.team.selectList=n.map((function(t,e){return{id:e,name:t,value:t}})),n.length>1&&(n.unshift("全部"),t.team.list=n)}})).catch((function(t){}))},fnOnSearch:function(){this.queryParams.page=0,this.isLoadMore=!1,this.fnToTopPage(),this.fnGetData()},fnOnTabChange:function(t){this.queryParams.team=0==t?void 0:this.team.list[t],this.queryParams.page=0,this.dataList=[],this.fnToTopPage(),this.fnGetData()},fnOnTakeTimeConfirm:function(t){this.takeTime="".concat(t.year,"-").concat(t.month,"-").concat(t.day," ").concat(t.hour,":").concat(t.min,":").concat(t.sec),this.form.takeTime=new Date(this.takeTime).getTime()},fnOnSelectTeamConfirm:function(t){var e=t[0].data;this.form.team=e.value},fnGetData:function(){var e=this;t.showLoading({mask:!0,title:"加载中..."}),this.isLoadMore||(this.loading="loading"),this.loadMoreText="加载中...",this.$httpApi.admin.getPhotos(this.queryParams).then((function(n){if(200==n.status){e.loadMoreText=n.data.hasNext?"上拉加载更多":"呜呜，没有更多数据啦~",e.result=n.data,e.total=n.data.total;var o=n.data.content.map((function(t){return t["showThumbnail"]=e.$utils.checkThumbnailUrl(t.thumbnail),t}));e.isLoadMore?e.dataList=e.dataList.concat(o):e.dataList=o,e.loading="success"}else t.$tm.toast("加载失败，请重试！"),e.loading="error"})).catch((function(n){console.error(n),t.$tm.toast("加载失败，请重试！"),e.loading="error",e.loadMoreText="加载失败，请下拉刷新！"})).finally((function(){setTimeout((function(){t.hideLoading(),t.stopPullDownRefresh()}),300)}))},fnOnAttachmentsSelectClose:function(){this.attachmentsSelectShow=!1},fnOnPoupBodyScroll:function(t){var e=this;(0,a.default)((function(){e.poupBodyScrollTop=t.detail.scrollTop}),1e3)},fnOnPoupChange:function(t){t||this.fnResetForm()},fnOnUrlInputChange:function(){this.form.url&&this.$set(this.form,"showThumbnail",this.$utils.checkThumbnailUrl(this.form.url))},fnShowAttachmentsSelect:function(t){this.selectAttachmentsType=t,this.attachmentsSelectShow=!0},fnOnAttachmentsSelect:function(t){"url"==this.selectAttachmentsType?(this.form.url=t.path,this.form.showThumbnail=this.$utils.checkThumbnailUrl(t.path),this.form.thumbnail||(this.form.thumbnail=t.path)):this.form.thumbnail=t.path,this.attachmentsSelectShow=!1},fnResetForm:function(){this.form={id:void 0,location:void 0,name:void 0,takeTime:void 0,team:void 0,thumbnail:void 0,url:void 0,description:void 0},this.takeTime=t.$tm.dayjs((new Date).getTime()).format("YYYY-MM-DD HH:mm:ss")},fnEdit:function(e){var n=this;this.poupBodyScrollTop=0,e.takeTime||(e.takeTime=(new Date).getTime()),this.takeTime=t.$tm.dayjs(e.takeTime).format("YYYY-MM-DD HH:mm:ss"),this.form=e,this.form.team?this.team.selected=[this.team.selectList.findIndex((function(t){return t.name==n.form.team}))]:this.team.selected=[],this.poupShow=!0},fnAdd:function(){this.fnResetForm(),this.poupBodyScrollTop=0,this.poupShow=!0},fnSave:function(){var e=this;return this.form.name?this.$utils.checkIsUrl(this.form.url)?this.$utils.checkIsUrl(this.form.thumbnail)?void(void 0==this.form.id?this.$httpApi.admin.createPhotos(this.form).then((function(n){200==n.status?(t.$tm.toast("保存成功！"),e.poupShow=!1,setTimeout((function(){e.fnResetForm(),e.fnGetTeamList(),t.startPullDownRefresh()}),1e3)):t.$tm.toast("操作失败，请重试！")})).catch((function(e){t.$tm.toast("操作失败，请重试！")})):this.$httpApi.admin.updatePhotosById(this.form.id,this.form).then((function(n){if(200==n.status){t.$tm.toast("保存成功！");var o=e.dataList.findIndex((function(t){return t.id==e.form.id}));e.$set(e.dataList,o,e.form),setTimeout((function(){e.fnGetTeamList()}),500)}else t.$tm.toast("操作失败，请重试！")})).catch((function(e){t.$tm.toast("操作失败，请重试！")}))):t.$tm.toast("请选择或输入正确的缩略图地址！"):t.$tm.toast("请选择或输入正确的图片地址！"):t.$tm.toast("请填写图片名称！")},fnDelete:function(e,n){var o=this;t.$eShowModal({title:"提示",content:"您是否删除名为 ".concat(e.name," 的图片？"),showCancel:!0,cancelText:"否",cancelColor:"#999999",confirmText:"是",confirmColor:"#03a9f4"}).then((function(i){o.$httpApi.admin.deletePhotosById(e.id).then((function(i){200==i.status?(t.$tm.toast("".concat(e.name," 分类已删除！")),o.dataList.splice(n,1)):t.$tm.toast("操作失败，请重试！")})).catch((function(e){t.$tm.toast("操作失败，请重试！")}))})).catch((function(t){}))},fnPreview:function(e,n){t.previewImage({current:n,urls:this.dataList.map((function(t){return t.url})),indicator:"number",loop:!0})}}};e.default=s}).call(this,n("543d")["default"])}},[["81fe","common/runtime","common/vendor"]]]);